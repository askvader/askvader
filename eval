#!/usr/bin/env runghc

import System.Environment
import System.Process

main = do

  [confCode,attrCode] <- getArgs
  let fullCode = "(" ++ confCode ++ ") (" ++ attrCode ++ ")"
  nixExpr1 <- readProcess "dhall-to-nix" [] fullCode

  pre <- readFile "pre.nix"
  let nixExpr = pre ++ nixExpr1

  -- DEBUG
  writeFile "tmp.nix" $ nixExpr

  -- Escape the nixExpr
  putStrLn $ "{\"nix\": " ++ show nixExpr ++ "}"
